<html>
<head>
<title>user.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(0,0,128); font-weight: bold; }
.s3 { color: rgb(0,128,0); font-weight: bold; }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
user.py</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0"># -*- coding: UTF-8 -*-</span><span class="s1"> 
 
</span><span class="s2">from </span><span class="s1">meeting </span><span class="s2">import </span><span class="s1">Meeting 
</span><span class="s2">from </span><span class="s1">session </span><span class="s2">import </span><span class="s1">Session 
</span><span class="s2">import </span><span class="s1">xml.etree.cElementTree </span><span class="s2">as </span><span class="s1">ET 
</span><span class="s2">import </span><span class="s1">os 
</span><span class="s2">import </span><span class="s1">workflow 
</span><span class="s2">import </span><span class="s1">codecs 
</span><span class="s2">import </span><span class="s1">xml.etree.ElementTree 
</span><span class="s2">from </span><span class="s1">session </span><span class="s2">import </span><span class="s1">Session 
</span><span class="s2">import </span><span class="s1">functions 
 
</span><span class="s2">class </span><span class="s1">User: 
    user_id=</span><span class="s3">''</span><span class="s1"> 
    nickname=</span><span class="s3">''</span><span class="s1"> 
    follows=[] 
    followed=[] 
    interest=[] 
    favors=[] 
    attended_meetings=[] 
    missed_meetings=[] 
 
    </span><span class="s0"># reserved meeting</span><span class="s1"> 
    schedule=[] 
 
    </span><span class="s2">def </span><span class="s1">__init__(self,id): 
        self.user_id=id 
 
    </span><span class="s2">def </span><span class="s1">groups(self): 
        user=ET.parse(self.user_file_path()) 
        group_list=[] 
        </span><span class="s2">for </span><span class="s1">group </span><span class="s2">in </span><span class="s1">user.iter(</span><span class="s3">'group'</span><span class="s1">): 
            group_list.append(group.text) 
        </span><span class="s2">return </span><span class="s1">group_list 
 
    </span><span class="s2">def </span><span class="s1">get_nickname(self): 
        tree=ET.parse(self.user_file_path()) 
        user=tree.getroot() 
        </span><span class="s2">return </span><span class="s1">user.find(</span><span class="s3">'nickname'</span><span class="s1">).text 
 
    </span><span class="s2">def </span><span class="s1">get_nickname(self,userid): 
        userpath=workflow.user_data_folder+userid 
        tree = ET.parse(self.user_file_path()) 
        user = tree.getroot() 
        </span><span class="s2">return </span><span class="s1">user.find(</span><span class="s3">'nickname'</span><span class="s1">).text 
 
    </span><span class="s2">def </span><span class="s1">save_session(self,new_session): 
        </span><span class="s2">try</span><span class="s1">: 
            tree = ET.parse(self.session_path()) 
            root = tree.getroot() 
            </span><span class="s2">for </span><span class="s1">sub </span><span class="s2">in </span><span class="s1">new_session.dic: 
                node=root.find(sub) 
                </span><span class="s2">if </span><span class="s1">node </span><span class="s2">is not </span><span class="s1">None: 
                    node.text=new_session.__dict__[sub] 
            </span><span class="s0">#root.find('current_group').text = new_session.current_group</span><span class="s1"> 
            </span><span class="s0">#root.find('current_process').text = new_session.current_process</span><span class="s1"> 
            </span><span class="s0">#root.find('current_step').text = new_session.current_step</span><span class="s1"> 
            </span><span class="s0">#root.find('current_meeting').text = new_session.current_meeting</span><span class="s1"> 
            tree.write(self.session_path()) 
        </span><span class="s2">except</span><span class="s1">: 
            self.current_session().rebuild_session(self.session_path()) 
 
    </span><span class="s2">def </span><span class="s1">user_file_path(self): 
        </span><span class="s2">return </span><span class="s1">os.path.join(workflow.user_data_folder, self.user_id + </span><span class="s3">&quot;.xml&quot;</span><span class="s1">) 
 
    </span><span class="s2">def </span><span class="s1">__group_users_file_path(self): 
        </span><span class="s2">if </span><span class="s1">self.current_session().current_group != </span><span class="s3">''</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s1">workflow.group_data_folder + self.current_session().current_group+</span><span class="s3">'/users.xml'</span><span class="s1"> 
        </span><span class="s2">else</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">''</span><span class="s1"> 
 
    </span><span class="s2">def </span><span class="s1">__meetings_file_path(self,groupname=None): 
        </span><span class="s2">if </span><span class="s1">groupname </span><span class="s2">is not </span><span class="s1">None: 
            </span><span class="s2">return </span><span class="s1">workflow.group_data_folder + groupname + </span><span class="s3">'/meetings.xml'</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">self.current_session().current_group != </span><span class="s3">''</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s1">workflow.group_data_folder + self.current_session().current_group+</span><span class="s3">'/meetings.xml'</span><span class="s1"> 
        </span><span class="s2">else</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">''</span><span class="s1"> 
 
    </span><span class="s2">def </span><span class="s1">session_path(self): 
        sessionpath=os.path.join(workflow.user_data_folder, self.user_id + </span><span class="s3">&quot;.session&quot;</span><span class="s1">) 
        </span><span class="s2">if not </span><span class="s1">os.path.isfile(sessionpath): 
            session=ET.Element(</span><span class="s3">&quot;session&quot;</span><span class="s1">) 
            ET.SubElement(session,</span><span class="s3">'current_group'</span><span class="s1">) 
            ET.SubElement(session, </span><span class="s3">'current_process'</span><span class="s1">) 
            ET.SubElement(session, </span><span class="s3">'current_step'</span><span class="s1">) 
            ET.SubElement(session, </span><span class="s3">'current_meeting'</span><span class="s1">) 
            tree=ET.ElementTree(session) 
            tree.write(sessionpath) 
        </span><span class="s2">return </span><span class="s1">sessionpath 
 
    </span><span class="s2">def </span><span class="s1">current_session(self): 
        session=Session() 
        session.load_session(self.session_path()) 
        </span><span class="s2">return </span><span class="s1">session 
 
    </span><span class="s2">def </span><span class="s1">setname(self, nickname): 
        </span><span class="s2">if not </span><span class="s1">os.path.exists(workflow.user_data_folder): 
            os.makedirs(workflow.user_data_folder) 
        </span><span class="s2">if not </span><span class="s1">os.path.isfile(self.user_file_path()): 
            user = ET.Element(</span><span class="s3">'user'</span><span class="s1">) 
            ET.SubElement(user, </span><span class="s3">'id'</span><span class="s1">).text = self.user_id 
            ET.SubElement(user, </span><span class="s3">'nickname'</span><span class="s1">).text = nickname 
            tree = ET.ElementTree(user) 
            tree.write(self.user_file_path()) 
 
        user = xml.etree.ElementTree.parse(self.user_file_path()) 
        </span><span class="s2">for </span><span class="s1">_nickname </span><span class="s2">in </span><span class="s1">user.iter(</span><span class="s3">'nickname'</span><span class="s1">): 
            _nickname.text=nickname 
        user.write(self.user_file_path(),encoding=</span><span class="s3">&quot;UTF-8&quot;</span><span class="s1">) 
        </span><span class="s2">return </span><span class="s3">'set nickname done.'</span><span class="s1"> 
 
    </span><span class="s2">def </span><span class="s1">creategroup(self, group_name): 
        path = workflow.group_data_folder + group_name 
        usersfilename = </span><span class="s3">&quot;users.xml&quot;</span><span class="s1"> 
        meetingsfilename=</span><span class="s3">&quot;meetings.xml&quot;</span><span class="s1"> 
        fullusersfilename = os.path.join(path, usersfilename) 
        fullmeetingsfilename=os.path.join(path, meetingsfilename) 
        </span><span class="s2">if not </span><span class="s1">os.path.exists(path): 
            os.makedirs(path) 
        </span><span class="s2">else</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">'group name used,choose a different group name.'</span><span class="s1"> 
        </span><span class="s2">if not </span><span class="s1">os.path.isfile(fullusersfilename): 
            users = ET.Element(</span><span class="s3">'users'</span><span class="s1">) 
            ET.SubElement(users, </span><span class="s3">'user'</span><span class="s1">).text =self.user_id 
            tree=ET.ElementTree(users) 
            tree.write(fullusersfilename,encoding=</span><span class="s3">&quot;UTF-8&quot;</span><span class="s1">) 
        </span><span class="s2">if not </span><span class="s1">os.path.isfile(fullmeetingsfilename): 
            meetings=ET.Element(</span><span class="s3">'meetings'</span><span class="s1">) 
            meeting=ET.SubElement(meetings,</span><span class="s3">'meeting'</span><span class="s1">) 
            ET.SubElement(meeting,</span><span class="s3">'state'</span><span class="s1">).text=</span><span class="s3">'done'</span><span class="s1"> 
            tree=ET.ElementTree(meetings) 
            tree.write(fullmeetingsfilename,encoding=</span><span class="s3">&quot;UTF-8&quot;</span><span class="s1">) 
        </span><span class="s0"># add group to user's groups element</span><span class="s1"> 
        tree=ET.parse(self.user_file_path()) 
        user=tree.getroot() 
        </span><span class="s2">if </span><span class="s1">ET.iselement(</span><span class="s3">'groups'</span><span class="s1">): 
            groups=user.find(</span><span class="s3">'groups'</span><span class="s1">) 
            ET.SubElement(groups,</span><span class="s3">'group'</span><span class="s1">).text=group_name 
        </span><span class="s2">else</span><span class="s1">: 
            groups=ET.SubElement(user,</span><span class="s3">'groups'</span><span class="s1">) 
            ET.SubElement(groups, </span><span class="s3">'group'</span><span class="s1">).text = group_name 
        tree.write(self.user_file_path(),encoding=</span><span class="s3">'UTF-8'</span><span class="s1">) 
        </span><span class="s2">return </span><span class="s1">path 
 
    </span><span class="s2">def </span><span class="s1">entergroup(self,groupname): 
        session=self.current_session() 
        </span><span class="s2">if </span><span class="s1">groupname </span><span class="s2">in </span><span class="s1">self.groups(): 
            session.current_group=groupname 
            session.current_step=</span><span class="s3">'a'</span><span class="s1"> 
            session.current_meeting=</span><span class="s3">''</span><span class="s1"> 
            self.save_session(session) 
            </span><span class="s2">return </span><span class="s3">'now in group '</span><span class="s1">+groupname 
        </span><span class="s2">else</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">'you do not belong to this group, or the group does not exist.'</span><span class="s1"> 
 
    </span><span class="s2">def </span><span class="s1">joingroup(self,groupname): 
        userfilepath=self.user_file_path() 
        grouppath = workflow.group_data_folder + groupname 
        </span><span class="s2">if not </span><span class="s1">os.path.exists(grouppath): 
            </span><span class="s2">return </span><span class="s3">'no this group.'</span><span class="s1"> 
        </span><span class="s2">else</span><span class="s1">: 
            </span><span class="s0"># update user file</span><span class="s1"> 
            self.current_session().current_group=groupname 
            tree=ET.parse(userfilepath) 
            user=tree.getroot() 
            groups=user.find(</span><span class="s3">'groups'</span><span class="s1">) 
            </span><span class="s2">for </span><span class="s1">group </span><span class="s2">in </span><span class="s1">groups.findall(</span><span class="s3">'group'</span><span class="s1">): 
                </span><span class="s2">if </span><span class="s1">group.text==groupname: 
                    </span><span class="s2">return </span><span class="s3">'you have joined this group.'</span><span class="s1"> 
            ET.SubElement(groups,</span><span class="s3">'group'</span><span class="s1">).text=groupname 
            tree.write(userfilepath) 
 
            </span><span class="s0"># update group file</span><span class="s1"> 
            tree=ET.parse(self.__group_users_file_path()) 
            users=tree.getroot() 
            </span><span class="s2">for </span><span class="s1">user </span><span class="s2">in </span><span class="s1">users.findall(</span><span class="s3">'user'</span><span class="s1">): 
                </span><span class="s2">if </span><span class="s1">user.text==self.user_id: 
                    </span><span class="s2">return </span><span class="s3">'joined already.'</span><span class="s1"> 
            ET.SubElement(users,</span><span class="s3">'user'</span><span class="s1">).text=self.user_id 
            tree.write(self.__group_users_file_path()) 
        </span><span class="s2">return </span><span class="s3">'joined '</span><span class="s1">+groupname 
 
    </span><span class="s2">def </span><span class="s1">createmeeting(self, parameter): 
        session=self.current_session() 
        session.current_process=</span><span class="s3">'createmeeting'</span><span class="s1"> 
        meetingfilepath = os.path.join(workflow.group_data_folder, session.current_group, </span><span class="s3">'meetings.xml'</span><span class="s1">) 
        tree = ET.parse(meetingfilepath) 
        meetings = tree.getroot() 
        </span><span class="s2">if </span><span class="s1">session.current_step==</span><span class="s3">'a'</span><span class="s1">: 
            meeting=ET.SubElement(meetings,</span><span class="s3">'meeting'</span><span class="s1">) 
            ET.SubElement(meeting,</span><span class="s3">'name'</span><span class="s1">).text=parameter 
            ET.SubElement(meeting,</span><span class="s3">'sponsor'</span><span class="s1">).text=self.user_id 
            ET.SubElement(meeting,</span><span class="s3">'state'</span><span class="s1">).text=</span><span class="s3">'1'</span><span class="s1"> 
            </span><span class="s0"># to do, unique id</span><span class="s1"> 
            meetingid=functions.get_id() 
            ET.SubElement(meeting,</span><span class="s3">'uuid'</span><span class="s1">).text=meetingid 
            attendusers=ET.SubElement(meeting,</span><span class="s3">'attendusers'</span><span class="s1">) 
            ET.SubElement(attendusers,</span><span class="s3">'user'</span><span class="s1">).text=self.user_id 
            tree.write(meetingfilepath,encoding=</span><span class="s3">'UTF-8'</span><span class="s1">) 
            session.current_step=</span><span class="s3">'b'</span><span class="s1"> 
            session.current_meeting=meetingid 
            self.save_session(session) 
            </span><span class="s2">return </span><span class="s3">'feel free to enter meeting place...'</span><span class="s1"> 
 
        </span><span class="s2">if </span><span class="s1">session.current_step==</span><span class="s3">'b'</span><span class="s1">: 
            </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">meetings.findall(</span><span class="s3">'meeting'</span><span class="s1">): 
                uuid=meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text 
                </span><span class="s2">if </span><span class="s1">uuid == session.current_meeting: 
                    place=ET.SubElement(meeting,</span><span class="s3">'place'</span><span class="s1">) 
                    place.text=parameter 
                    </span><span class="s2">break</span><span class="s1"> 
            tree.write(meetingfilepath,encoding=</span><span class="s3">'UTF-8'</span><span class="s1">) 
            session.current_step=</span><span class="s3">'c'</span><span class="s1"> 
            self.save_session(session) 
            </span><span class="s2">return </span><span class="s3">'choose a date...'</span><span class="s1"> 
 
        </span><span class="s2">if </span><span class="s1">session.current_step==</span><span class="s3">'c'</span><span class="s1">: 
            </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">meetings.findall(</span><span class="s3">'meeting'</span><span class="s1">): 
                uuid=meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text 
                </span><span class="s2">if </span><span class="s1">uuid == session.current_meeting: 
                    ET.SubElement(meeting,</span><span class="s3">'date'</span><span class="s1">).text=parameter 
                    </span><span class="s2">break</span><span class="s1"> 
            tree.write(meetingfilepath,encoding=</span><span class="s3">'UTF-8'</span><span class="s1">) 
            session.current_step=</span><span class="s3">'d'</span><span class="s1"> 
            self.save_session(session) 
            </span><span class="s2">return </span><span class="s3">'say something about play sha.'</span><span class="s1"> 
 
        </span><span class="s2">if </span><span class="s1">session.current_step==</span><span class="s3">'d'</span><span class="s1">: 
            </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">meetings.findall(</span><span class="s3">'meeting'</span><span class="s1">): 
                uuid=meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text 
                </span><span class="s2">if </span><span class="s1">uuid == session.current_meeting: 
                    ET.SubElement(meeting,</span><span class="s3">'content'</span><span class="s1">).text=parameter 
                    </span><span class="s2">break</span><span class="s1"> 
            tree.write(meetingfilepath,encoding=</span><span class="s3">'UTF-8'</span><span class="s1">) 
            session.current_process=</span><span class="s3">''</span><span class="s1"> 
            session.current_step=</span><span class="s3">'a'</span><span class="s1"> 
            self.save_session(session) 
            </span><span class="s2">return </span><span class="s3">'OK le.'</span><span class="s1"> 
 
        session.current_step=</span><span class="s3">'a'</span><span class="s1"> 
        self.save_session(session) 
        </span><span class="s2">return </span><span class="s3">'failed'</span><span class="s1"> 
 
    </span><span class="s0"># parameter should be meeting name or its id</span><span class="s1"> 
    </span><span class="s2">def </span><span class="s1">entermeeting(self,parameter): 
        meetingspath=self.__meetings_file_path() 
        </span><span class="s2">if </span><span class="s1">meetingspath==</span><span class="s3">''</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">'need to enter a group first.(command:entergroup &lt;groupname&gt;)'</span><span class="s1"> 
        </span><span class="s2">else</span><span class="s1">: 
            tree=ET.parse(self.__meetings_file_path()) 
            meetings=tree.getroot() 
            </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">meetings.findall(</span><span class="s3">'meeting'</span><span class="s1">): 
                </span><span class="s2">if </span><span class="s1">meeting.find(</span><span class="s3">'name'</span><span class="s1">).text==parameter: 
                    self.current_session().current_meeting=meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text 
                    </span><span class="s2">return </span><span class="s3">'you now in meeting:' </span><span class="s1">+ parameter 
                </span><span class="s2">if </span><span class="s1">meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text==parameter: 
                    self.current_session().current_meeting=parameter 
                    </span><span class="s2">return </span><span class="s3">'you now in meeting:' </span><span class="s1">+ parameter 
        </span><span class="s2">return </span><span class="s1">parameter+</span><span class="s3">&quot; not found.&quot;</span><span class="s1"> 
 
    </span><span class="s2">def </span><span class="s1">joinmeeting(self,parameter): 
        meetingspath = self.__meetings_file_path() 
        </span><span class="s2">if </span><span class="s1">meetingspath == </span><span class="s3">''</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">'need to enter a group first.(command:entergroup &lt;groupname&gt;)'</span><span class="s1"> 
        </span><span class="s2">else</span><span class="s1">: 
            tree = ET.parse(self.__meetings_file_path()) 
            meetings = tree.getroot() 
            </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">meetings.findall(</span><span class="s3">'meeting'</span><span class="s1">): 
                </span><span class="s2">if </span><span class="s1">meeting.find(</span><span class="s3">'name'</span><span class="s1">).text == parameter: 
                    self.current_session().current_meeting = meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text 
                    attendusers=meeting.find(</span><span class="s3">'attendusers'</span><span class="s1">) 
                    </span><span class="s2">for </span><span class="s1">user </span><span class="s2">in </span><span class="s1">attendusers.findall(</span><span class="s3">'user'</span><span class="s1">): 
                        </span><span class="s2">if </span><span class="s1">user.text==self.user_id: 
                            </span><span class="s2">return </span><span class="s3">'you have joined, be calm.'</span><span class="s1"> 
                    ET.SubElement(attendusers,</span><span class="s3">'user'</span><span class="s1">).text=self.user_id 
                    tree.write(meetingspath) 
                    </span><span class="s2">return </span><span class="s3">'you now joined meeting:' </span><span class="s1">+ parameter 
                </span><span class="s2">if </span><span class="s1">meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text == parameter: 
                    self.current_session().current_meeting = parameter 
                    attendusers = meeting.find(</span><span class="s3">'attendusers'</span><span class="s1">) 
                    </span><span class="s2">for </span><span class="s1">user </span><span class="s2">in </span><span class="s1">attendusers.findall(</span><span class="s3">'user'</span><span class="s1">): 
                        </span><span class="s2">if </span><span class="s1">user.text==self.user_id: 
                            </span><span class="s2">return </span><span class="s3">'you have joined, be calm.'</span><span class="s1"> 
                    ET.SubElement(attendusers,</span><span class="s3">'user'</span><span class="s1">).text=self.user_id 
                    tree.write(meetingspath) 
                    </span><span class="s2">return </span><span class="s3">'you now joined meeting:' </span><span class="s1">+ parameter 
        </span><span class="s2">return </span><span class="s1">parameter + </span><span class="s3">&quot; not found.&quot;</span><span class="s1"> 
 
 
    </span><span class="s2">def </span><span class="s1">showallmeetings(self,groupname=None): 
        session=self.current_session() 
        </span><span class="s2">try</span><span class="s1">: 
            tree=ET.parse(self.__meetings_file_path(groupname)) 
        </span><span class="s2">except</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">'can not find the group.'</span><span class="s1"> 
        meetings=tree.getroot() 
        undonemeetings=[] 
        message=</span><span class="s3">''</span><span class="s1"> 
        </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">meetings: 
            state=meeting.find(</span><span class="s3">'state'</span><span class="s1">) 
            </span><span class="s2">if </span><span class="s1">state </span><span class="s2">is not </span><span class="s1">None: 
                </span><span class="s2">if </span><span class="s1">state.text </span><span class="s2">is </span><span class="s3">'1'</span><span class="s1">: 
                    undonemeetings.append(meeting) 
        </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">undonemeetings: 
            name=meeting.find(</span><span class="s3">'name'</span><span class="s1">).text 
            date=meeting.find(</span><span class="s3">'date'</span><span class="s1">).text 
            place=meeting.find(</span><span class="s3">'place'</span><span class="s1">).text 
            content=meeting.find(</span><span class="s3">'content'</span><span class="s1">).text 
            message+=</span><span class="s3">'name:'</span><span class="s1">+name+</span><span class="s3">'</span><span class="s2">\r\n</span><span class="s3">'    </span><span class="s1">\ 
                    </span><span class="s3">'date:'</span><span class="s1">+date+</span><span class="s3">'</span><span class="s2">\r\n</span><span class="s3">'     </span><span class="s1">\ 
                    </span><span class="s3">'place:'</span><span class="s1">+place+</span><span class="s3">'</span><span class="s2">\r\n</span><span class="s3">'   </span><span class="s1">\ 
                    </span><span class="s3">'content:'</span><span class="s1">+content+</span><span class="s3">'</span><span class="s2">\r\n\r\n</span><span class="s3">'</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">message 
 
    </span><span class="s2">def </span><span class="s1">showattendusers(self,meetingname): 
        message=</span><span class="s3">''</span><span class="s1"> 
        </span><span class="s2">if </span><span class="s1">self.current_session().current_group==</span><span class="s3">''</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">'enter a group first.'</span><span class="s1"> 
        </span><span class="s2">elif </span><span class="s1">self.current_session().current_meeting==</span><span class="s3">''</span><span class="s1">: 
            </span><span class="s2">return </span><span class="s3">'enter a meeting first.'</span><span class="s1"> 
        </span><span class="s2">else</span><span class="s1">: 
            tree=ET.parse(self.__meetings_file_path()) 
            meetings=tree.getroot() 
            </span><span class="s2">for </span><span class="s1">meeting </span><span class="s2">in </span><span class="s1">meetings.findall(</span><span class="s3">'meeting'</span><span class="s1">): 
                </span><span class="s2">if </span><span class="s1">meeting.find(</span><span class="s3">'name'</span><span class="s1">).text==meetingname: 
                    </span><span class="s2">if </span><span class="s1">meeting.find(</span><span class="s3">'state'</span><span class="s1">).text==</span><span class="s3">'1'</span><span class="s1">: 
                        attendusers=meeting.find(</span><span class="s3">'attendusers'</span><span class="s1">) 
                        </span><span class="s2">for </span><span class="s1">user </span><span class="s2">in </span><span class="s1">attendusers.findall(</span><span class="s3">'user'</span><span class="s1">): 
                            message+=self.get_nickname(user.text)+</span><span class="s3">' '</span><span class="s1"> 
                </span><span class="s2">if </span><span class="s1">meeting.find(</span><span class="s3">'uuid'</span><span class="s1">).text==meetingname: 
                    attendusers = meeting.find(</span><span class="s3">'attenduser'</span><span class="s1">) 
                    </span><span class="s2">for </span><span class="s1">user </span><span class="s2">in </span><span class="s1">attendusers.findall(</span><span class="s3">'user'</span><span class="s1">): 
                        message += self.get_nickname(user.text) + </span><span class="s3">' '</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">message</span></pre>
</body>
</html>